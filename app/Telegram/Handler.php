<?

namespace App\Telegram;

use DefStudio\Telegraph\Handlers\WebhookHandler;
use Illuminate\Http\Request;
use DefStudio\Telegraph\Models\TelegraphBot;
use Illuminate\Support\Stringable;
use DefStudio\Telegraph\Facades\Telegraph;
use Illuminate\Support\Facades\Storage;
use DefStudio\Telegraph\Keyboard\ReplyKeyboard;
use DefStudio\Telegraph\Keyboard\ReplyButton;
use DefStudio\Telegraph\Keyboard\Button;
use DefStudio\Telegraph\Keyboard\Keyboard;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Carbon;
use DefStudio\Telegraph\Models\TelegraphChat;
use App\Http\Controllers\Helper;

class Handler extends WebhookHandler
{

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—ã
    public function hello()
    {
        $this->reply('–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ :)');
        /*         $users = DB::table('telegraph_chats')->get();
        foreach($users as $user){
            $messageToAllUsers = TelegraphChat::find($user->id);
            $messageToAllUsers->message('–ø—Ä–æ–≤–µ—Ä–∞ –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞')->send();
        } */
    }

    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
    protected function handleUnknownCommand(Stringable $text): void
    {
        if ($text->value() === '/start') {
            $this->chat->message('
*–ü—Ä–∏–≤–µ—Ç! –Ø - –≥–æ—Ä–æ—Å–∫–æ–ø –±–æ—Ç ‚ú®*

–Ø –ø—Ä–µ–¥—Å–∫–∞–∂—É —Ç–≤–æ–π –¥–µ–Ω—å –Ω–∞ –∑–∞–≤—Ç—Ä–∞, –ø—Ä–æ–≤–µ—Ä—é –≤–∞—à—É —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º, –∞ —Ç–∞–∫–∂–µ —Å–¥–µ–ª–∞—é —Ä–∞—Å–∫–ª–∞–¥ –Ω–∞ –∫–∞—Ä—Ç–∞—Ö –¢–∞—Ä–æ üîÆ
            ')->photo(Storage::path('start_logo.jpeg'))->send();

            $this->chat->message('1')->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('üíü –õ—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'),
                        ReplyButton::make('üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø'),
                    ])
                    ->row([
                        ReplyButton::make('üü£ –ú–∞–≥–∏—è —á–∏—Å–µ–ª'),
                        ReplyButton::make('üÄÑÔ∏è –ö–∞—Ä—Ç—ã —Ç–∞—Ä–æ'),
                    ])
                    ->row([
                        ReplyButton::make('üèµ –í–æ—Å—Ç–æ—á–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'),
                    ])
            )
                ->send();
        } else {
            $this->reply('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞');
        }
    }


    // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    protected function handleChatMessage(Stringable $text): void
    {
        if ($text == 'üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é') {
            $this->chat->message('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é')->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('üíü –õ—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'),
                        ReplyButton::make('üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø'),
                    ])
                    ->row([
                        ReplyButton::make('ü™¨ –•–∏—Ä–æ–º–∞–Ω—Ç–∏—è'),
                        ReplyButton::make('üÄÑÔ∏è –ö–∞—Ä—Ç—ã —Ç–∞—Ä–æ'),
                    ])
                    ->row([
                        ReplyButton::make('üèµ –í–æ—Å—Ç–æ—á–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'),
                    ])
            )
                ->send();
        }

        if ($text == 'ü™¨ –•–∏—Ä–æ–º–∞–Ω—Ç–∏—è') {
            $this->chat->message('*–õ–∏–Ω–∏–∏ –Ω–∞ –ª–∞–¥–æ–Ω–∏ –ø–æ–¥—Å–∫–∞–∂—É—Ç, –∫–∞–∫–∞—è —Å—É–¥—å–±–∞ –í–∞—Å –æ–∂–∏–¥–∞–µ—Ç. –ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –æ—Å–Ω–æ–≤–∞–º–∏ –∫–∏—Ç–∞–π—Å–∫–æ–π —Ö–∏—Ä–æ–º–∞–Ω—Ç–∏–∏, –Ω–∞—É—á–∏—Ç–µ—Å—å —á–∏—Ç–∞—Ç—å –ª–∏–Ω–∏–∏ –Ω–∞ —Ä—É–∫–µ –∏ —É–∑–Ω–∞–π—Ç–µ, –∫–∞–∫–∏–º–∏ –±—ã–≤–∞—é—Ç: –ª–∏–Ω–∏—è –∂–∏–∑–Ω–∏, –ª–∏–Ω–∏—è —Å—É–¥—å–±—ã, –ª–∏–Ω–∏—è –±—Ä–∞–∫–∞, –ª–∏–Ω–∏—è –ª—é–±–≤–∏!*

–•–∏—Ä–æ–º–∞–Ω—Ç–∏—è –æ—Å–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –Ω–∞ –∏–∑—É—á–µ–Ω–∏–∏ —Ñ–æ—Ä–º—ã, —Ü–≤–µ—Ç–∞ –∏ –ª–∏–Ω–∏–∏ –Ω–∞ –ª–∞–¥–æ–Ω–∏, –∞ —Ç–∞–∫–∂–µ –¥–ª–∏–Ω—ã –ø–∞–ª—å—Ü–µ–≤. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ö–∏—Ä–æ–º–∞–Ω—Ç—ã —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –≤–æ –≤–Ω–∏–º–∞–Ω–∏–µ —É–∑–æ—Ä—ã –Ω–∞ –ø–æ–¥—É—à–µ—á–∫–∞—Ö –ø–∞–ª—å—Ü–µ–≤.
–ì–∞–¥–∞–Ω–∏–µ –ø–æ —Ä—É–∫–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —É–¥–∞—á—É –∏–ª–∏ –Ω–µ—É–¥–∞—á—É. –í–∞—à–∞ —Ä—É–∫–∞, –ª–∏–Ω–∏—è –Ω–∞ –ª–∞–¥–æ–Ω–∏ –∏ –∑–Ω–∞–Ω–∏—è –æ–ø—ã—Ç–Ω–æ–≥–æ —Ö–∏—Ä–æ–º–∞–Ω—Ç–∞ –ø–æ–º–æ–≥—É—Ç —É–∑–Ω–∞—Ç—å –æ –∂–∏–∑–Ω–∏ –∏ —Å—É–¥—å–±–µ –∏ –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è.
            ')->photo(Storage::path('hiro1.webp'))->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('üíü –õ—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'),
                        ReplyButton::make('üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø'),
                    ])
                    ->row([
                        ReplyButton::make('ü™¨ –•–∏—Ä–æ–º–∞–Ω—Ç–∏—è'),
                        ReplyButton::make('üÄÑÔ∏è –ö–∞—Ä—Ç—ã —Ç–∞—Ä–æ'),
                    ])
                    ->row([
                        ReplyButton::make('üèµ –í–æ—Å—Ç–æ—á–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'),
                    ])
            )
                ->send();

                $this->chat->message('*1. –õ–∏–Ω–∏—è –∂–∏–∑–Ω–∏ - —á–µ–º –¥–ª–∏–Ω–Ω–µ–µ, —Ç–µ–º –ª—É—á—à–µ*
–õ–∏–Ω–∏—è –∂–∏–∑–Ω–∏ - –µ—ë —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞—é—Ç "–ª–∏–Ω–∏–µ–π –∑–µ–º–ª–∏". —ç—Ç–æ –ª–∏–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–æ–∫—Ä—É–≥ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞. –û–±—ã—á–Ω–æ —ç—Ç–æ –¥—É–≥–∞. –î–ª–∏–Ω–∞ –ª–∏–Ω–∏–∏ –∂–∏–∑–Ω–∏ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞. –û–Ω –æ—Ç—Ä–∞–∂–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.
–õ–∏–Ω–∏—è –∂–∏–∑–Ω–∏ - —ç—Ç–æ –ª–∏–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–æ–∫—Ä—É–≥ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞. –û–±—ã—á–Ω–æ —ç—Ç–æ –¥—É–≥–∞. –î–ª–∏–Ω–∞ –ª–∏–Ω–∏–∏ –∂–∏–∑–Ω–∏ –Ω–µ –∏–º–µ–µ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∫ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∂–∏–∑–Ω–∏ —á–µ–ª–æ–≤–µ–∫–∞. –û–Ω –æ—Ç—Ä–∞–∂–∞–µ—Ç –∑–¥–æ—Ä–æ–≤—å–µ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –∂–∏–∑–Ω–µ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å.
            ')->photo(Storage::path('hiro2.webp'))->send();
                $this->chat->message('–ï—Å–ª–∏ –ª–∏–Ω–∏—è –∂–∏–∑–Ω–∏ –∏–º–µ–µ—Ç –±–æ–ª—å—à—É—é –¥—É–≥—É –∏ –≤—ã–≥–ª—è–¥–∏—Ç —á–µ—Ç–∫–æ–π, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ —ç–Ω–µ—Ä–≥–∏—á–µ–Ω. –ß–µ–º –¥–ª–∏–Ω–Ω–µ–µ –ª–∏–Ω–∏—è –∂–∏–∑–Ω–∏, —Ç–µ–º –ª—É—á—à–µ. –õ—é–¥–∏ —Å –¥–ª–∏–Ω–Ω–æ–π –ª–∏–Ω–∏–µ–π –∂–∏–∑–Ω–∏ –æ–±—ã—á–Ω–æ —Ö–æ—Ä–æ—à–æ –∑–∞–Ω–∏–º–∞—é—Ç—Å—è —Å–ø–æ—Ä—Ç–æ–º.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è –∂–∏–∑–Ω–∏ –∏–º–µ–µ—Ç –Ω–µ–±–æ–ª—å—à—É—é –¥—É–≥—É –∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä—è–¥–æ–º —Å –±–æ–ª—å—à–∏–º –ø–∞–ª—å—Ü–µ–º, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –Ω–µ –∑–¥–æ—Ä–æ–≤ –∏ –±—ã—Å—Ç—Ä–æ —É—Å—Ç–∞–µ—Ç.
            ')->photo(Storage::path('hiro3.webp'))->send();

                $this->chat->message('–ï—Å–ª–∏ –∏–º–µ–µ—Ç—Å—è –±–æ–ª–µ–µ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ –∂–∏–∑–Ω–∏, —ç—Ç–æ —Ç–∞–∫–∂–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ç–æ, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –æ—á–µ–Ω—å –ø–æ–ª–æ–Ω –∂–∏–∑–Ω–∏.
–ï—Å–ª–∏ –Ω–∞—á–∞–ª–æ –ª–∏–Ω–∏–∏ –∂–∏–∑–Ω–∏ (–æ–∫–æ–ª–æ –ø–µ—Ä–µ–ø–æ–Ω–∫–∏ –±–æ–ª—å—à–æ–≥–æ –ø–∞–ª—å—Ü–∞) –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è, –æ–Ω —á–∞—Å—Ç–æ –±–æ–ª–µ–ª –≤ –¥–µ—Ç—Å—Ç–≤–µ.
–ï—Å–ª–∏ –∫–æ–Ω–µ—Ü –ª–∏–Ω–∏–∏ –∂–∏–∑–Ω–∏ (–æ–∫–æ–ª–æ –∑–∞–ø—è—Å—Ç—å—è) –≤—ã–≥–ª—è–¥–∏—Ç –ø–æ—Ç—Ä–µ–ø–∞–Ω–Ω—ã–º, –µ–º—É —Å–ª–µ–¥—É–µ—Ç —É–¥–µ–ª—è—Ç—å –±–æ–ª—å—à–µ –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ –∑–¥–æ—Ä–æ–≤—å–µ, –∫–æ–≥–¥–∞ –æ–Ω —Å—Ç–∞—Ä–µ–µ—Ç.
–ï—Å–ª–∏ –Ω–∞ –ª–∏–Ω–∏–∏ –µ—Å—Ç—å –∫—Ä—É–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Å—Ç—Ä–æ–≤) –∏–ª–∏ –ª–∏–Ω–∏—è –≥–¥–µ-—Ç–æ —Ä–∞–∑—Ä–µ–∑–∞–Ω–∞, –æ–Ω / –æ–Ω–∞ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫—É—é —Ç—Ä–∞–≤–º—É –∏–ª–∏ –æ–∫–∞–∑–∞—Ç—å—Å—è –≤ –±–æ–ª—å–Ω–∏—Ü–µ. –†–∞–∑–º–µ—Ä –∫—Ä—É–≥–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å–µ—Ä—å–µ–∑–Ω–æ—Å—Ç—å –±–æ–ª–µ–∑–Ω–∏ / —Ç—Ä–∞–≤–º—ã.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è –∂–∏–∑–Ω–∏ –ø—Ä—è–º–∞—è –∏ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç –ª–∞–¥–æ–Ω—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –ª–∏–Ω–∏–∏ –≥–æ–ª–æ–≤—ã, –æ–Ω / –æ–Ω–∞ —Ö—Ä–∞–±—Ä—ã–π –∏ –æ–±—ã—á–Ω–æ –æ—á–µ–Ω—å –æ–±—â–∏—Ç–µ–ª—å–Ω—ã–π —á–µ–ª–æ–≤–µ–∫.
            ')->photo(Storage::path('hiro4.webp'))->send();

            sleep(2);
                $this->chat->message('*2. –õ–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ (–ª–∏–Ω–∏—è –ª—é–±–≤–∏) - —á–µ–º –¥–ª–∏–Ω–Ω–µ–µ, —Ç–µ–º –ª—É—á—à–µ.*
–õ–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞, –∫–æ—Ç–æ—Ä—É—é –∏–Ω–æ–≥–¥–∞ –Ω–∞–∑—ã–≤–∞—é—Ç –ª–∏–Ω–∏–µ–π –ª—é–±–≤–∏, - —ç—Ç–æ –ª–∏–Ω–∏—è, –ø—Ä–æ—Ö–æ–¥—è—â–∞—è —á–µ—Ä–µ–∑ —Ä—É–∫—É –ø—Ä—è–º–æ –ø–æ–¥ –ø–∞–ª—å—Ü–∞–º–∏. –õ–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –≤–µ—â–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–¥—Ü–µ–º, —Ç–∞–∫–∏–µ –∫–∞–∫ —á—É–≤—Å—Ç–≤–∞, —Ä–µ–∞–∫—Ü–∏–∏, –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —ç–º–æ—Ü–∏—è–º–∏ –∏ —Ç. –î. –ß–µ–º –¥–ª–∏–Ω–Ω–µ–µ –∏ –ø—Ä—è–º–µ–µ –æ–Ω–∞, —Ç–µ–º –ª—É—á—à–µ.
–õ–∏–Ω–∏—è –ª—é–±–≤–∏ —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "–Ω–µ–±–µ—Å–Ω–æ–π –ª–∏–Ω–∏–µ–π",
–ï—Å–ª–∏ –ª–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ –∫–æ—Ä–æ—Ç–∫–∞—è –∏ –ø—Ä—è–º–∞—è, –æ–Ω / –æ–Ω–∞ –º–∞–ª–æ –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω—ã –≤ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ –ª—é–±–≤–∏ –∏–ª–∏ —Ä–æ–º–∞–Ω—Ç–∏–∫–∏.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ –¥–ª–∏–Ω–Ω–∞—è, –æ–Ω, –≤–µ—Ä–æ—è—Ç–Ω–æ, –±—É–¥–µ—Ç —Ö–æ—Ä–æ—à–∏–º –ª—é–±–æ–≤–Ω–∏–∫–æ–º - –º–∏–ª—ã–º, –ø–æ–Ω–∏–º–∞—é—â–∏–º –∏ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–º.
            ')->photo(Storage::path('hiro5.webp'))->send();

                $this->chat->message('–ï—Å–ª–∏ –ª–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ –ø–∞–ª—å—Ü–∞, –ø—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—á–∞—Å—Ç–ª–∏–≤—ã–π –ª—é–±–æ–≤.
–ï—Å–ª–∏ –æ–Ω –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–æ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–∞–ª—å—Ü–∞, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á–µ–ª–æ–≤–µ–∫ –æ–±—ã—á–Ω–æ –¥—É–º–∞–µ—Ç –æ —Å–µ–±–µ –±–æ–ª—å—à–µ, —á–µ–º –æ —Å–≤–æ–µ–º –≤–æ–∑–ª—é–±–ª–µ–Ω–Ω–æ–º.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ –∏–º–µ–µ—Ç –±–æ–ª—å—à–æ–π –ø–æ–¥—ä–µ–º –∏ –ø–∞–¥–µ–Ω–∏–µ, –æ–Ω / –æ–Ω–∞, –≤–µ—Ä–æ—è—Ç–Ω–æ, –≤–ª—é–±–∏—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–µ–ª–æ–≤–µ–∫.–ö–∞–∂–¥–∞—è –∏—Å—Ç–æ—Ä–∏—è –ª—é–±–≤–∏ –æ–±—ã—á–Ω–æ –¥–ª–∏—Ç—Å—è –Ω–µ–¥–æ–ª–≥–æ.
–ï—Å–ª–∏ –Ω–∞ –ª–∏–Ω–∏–∏ —Å–µ—Ä–¥—Ü–∞ –µ—Å—Ç—å –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä—É–≥–æ–≤, –ª–∏–Ω–∏—è —Å–µ—Ä–¥—Ü–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–µ–π –∏–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö —Ç–æ–Ω–∫–∏—Ö –ª–∏–Ω–∏–π, –ø–µ—Ä–µ—Å–µ–∫–∞—é—â–∏—Ö –ª–∏–Ω–∏—é —Å–µ—Ä–¥—Ü–∞, —ç—Ç–æ –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω / –æ–Ω–∞ –Ω–µ –æ—á–µ–Ω—å –¥–æ–≤–æ–ª–µ–Ω —Å–≤–æ–µ–π –Ω—ã–Ω–µ—à–Ω–µ–π –ª—é–±–æ–≤–Ω–æ–π –∂–∏–∑–Ω—å—é.
            ')->photo(Storage::path('hiro6.webp'))->send();

            sleep(2);
                $this->chat->message('*3. –õ–∏–Ω–∏—è –°—É–¥—å–±—ã - –ß–∏—Å—Ç–∞—è –∏ –ø—Ä—è–º–∞—è - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ.*
–õ–∏–Ω–∏—è –°—É–¥—å–±—ã, —Ç–∞–∫–∂–µ –Ω–∞–∑—ã–≤–∞–µ–º–∞—è –î–µ–Ω–µ–∂–Ω–∞—è –ª–∏–Ω–∏—è, "–ª–∏–Ω–∏–µ–π –∫–∞—Ä—å–µ—Ä—ã",- —ç—Ç–æ –ª–∏–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ—Ç –∑–∞–ø—è—Å—Ç—å—è –¥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø–∞–ª—å—Ü–∞ –∏ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ –∫–∞—Ä—å–µ—Ä—É.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è –°—É–¥—å–±—ã –∏ –ª–∏–Ω–∏—è –∂–∏–∑–Ω–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Ç–æ—á–∫–∏, —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫ –æ–±—ã—á–Ω–æ –∞–º–±–∏—Ü–∏–æ–∑–µ–Ω –∏ –∏–º–µ–µ—Ç —Å–∏–ª—å–Ω—É—é —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ —Å–µ–±–µ.
–ï—Å–ª–∏ –µ—Å—Ç—å –¥–≤–µ –ª–∏–Ω–∏–∏ –°—É–¥—å–±—ã, –æ–Ω / –æ–Ω–∞ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –¥–≤–µ —Ä–∞–±–æ—Ç—ã –≤–º–µ—Å—Ç–µ –∏–ª–∏ –ø–æ–±–æ—á–Ω—ã–π –±–∏–∑–Ω–µ—Å.
            ')->photo(Storage::path('hiro7.webp'))->send();

                $this->chat->message('–ï—Å–ª–∏ –ª–∏–Ω–∏—è –°—É–¥—å–±—ã –≤—ã–≥–ª—è–¥–∏—Ç —á–µ—Ç–∫–æ–π –∏ –ø—Ä—è–º–æ–π, —ç—Ç–æ –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç —Ö–æ—Ä–æ—à–µ–µ –∏ —Å—á–∞—Å—Ç–ª–∏–≤–æ–µ –±—É–¥—É—â–µ–µ.
–õ–∏–Ω–∏—è –°—É–¥—å–±—ã —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –¥–≤–∞ –∏–ª–∏ –±–æ–ª–µ–µ —Ä–∞–∑–¥–µ–ª–æ–≤. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —ç—Ç–æ—Ç —á–µ–ª–æ–≤–µ–∫, –≤–µ—Ä–æ—è—Ç–Ω–æ, –±—É–¥–µ—Ç —á–∞—Å—Ç–æ –º–µ–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É –∏–ª–∏ –≤ –µ–≥–æ / –µ–µ –∂–∏–∑–Ω–∏ / –∫–∞—Ä—å–µ—Ä–µ –ø—Ä–æ–∏–∑–æ–π–¥—É—Ç –±–æ–ª—å—à–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è –°—É–¥—å–±—ã –∫–æ—Ä–æ—Ç–∫–∞—è, —ç—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–Ω / –æ–Ω–∞ –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å—Ç–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –¥–æ –≤—ã—Ö–æ–¥–∞ –Ω–∞ –ø–µ–Ω—Å–∏—é.
            ')->photo(Storage::path('hiro8.webp'))->send();

                $this->chat->message('*4. –õ–∏–Ω–∏—è —É–º—ã - —á–µ–º —á–µ—Ç—á–µ –∏ –¥–ª–∏–Ω–Ω–µ–µ, —Ç–µ–º –ª—É—á—à–µ.*
–õ–∏–Ω–∏—è —É–º—ã –æ—Ç—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –º–µ–Ω—Ç–∞–ª–∏—Ç–µ—Ç —á–µ–ª–æ–≤–µ–∫–∞. –û–±—ã—á–Ω–æ –æ–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –º–µ–∂–¥—É —É–∫–∞–∑–∞—Ç–µ–ª—å–Ω—ã–º –∏ –±–æ–ª—å—à–∏–º –ø–∞–ª—å—Ü–∞–º–∏ (–Ω–∏–∂–µ –ª–∏–Ω–∏–∏ –ª—é–±–≤–∏), –∞ –∑–∞—Ç–µ–º —Ç—è–Ω–µ—Ç—Å—è –∫ –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω–µ –ª–∞–¥–æ–Ω–∏, –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –ª–∞–¥–æ–Ω—å –ø–æ–ø–æ–ª–∞–º.
–ß–µ—Ç–∫–æ—Å—Ç—å, —Ç–æ–Ω–∫–æ—Å—Ç—å –∏ –¥–ª–∏–Ω–∞ –ª–∏–Ω–∏–∏ —É–º—ã –æ—Ç—Ä–∞–∂–∞—é—Ç —É–º—Å—Ç–≤–µ–Ω–Ω—É—é –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—é –∏ —Å–æ–æ–±—Ä–∞–∑–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.
–ë–æ–ª—å—à–∞—è –¥—É–≥–∞ –ª–∏–Ω–∏–∏ —É–º—ã –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞–º –æ —Ç–æ–º, —á—Ç–æ –æ–Ω / –æ–Ω–∞ –±–æ–≥–∞—Ç—ã —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º.
–ö–æ—Ä–æ—Ç–∫–∞—è –ª–∏–Ω–∏—è —É–º—ã –æ–±—ã—á–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —É —á–µ–ª–æ–≤–µ–∫–∞ –±–æ–ª—å—à–µ —à–∞–Ω—Å–æ–≤ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è, —á–µ–º –Ω–∞ —É–º—Å—Ç–≤–µ–Ω–Ω—ã–µ.
–ï—Å–ª–∏ –Ω–∞ –ª–∏–Ω–∏–∏ —É–º—ã –µ—Å—Ç—å –∫—Ä—É–≥, –ª–∏–Ω–∏—è —É–º—ã —Ä–∞–∑—Ä–µ–∑–∞–Ω–∞ –Ω–∞ –¥–≤–µ (–∏–ª–∏ –±–æ–ª–µ–µ) —á–∞—Å—Ç–∏ –∏–ª–∏ –ª–∏–Ω–∏—è —É–º—ã –∫–æ–ª–µ–±–ª–µ—Ç—Å—è, —É –Ω–µ–≥–æ / –Ω–µ–µ —Å—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ –ø–ª–æ—Ö–∞—è –ø–∞–º—è—Ç—å, –µ–≥–æ –ª–µ–≥–∫–æ –±–µ—Å–ø–æ–∫–æ—è—Ç –¥—Ä—É–≥–∏–µ –∏ –æ–±—ã—á–Ω–æ –æ–Ω –Ω–µ —Å–æ—Å—Ä–µ–¥–æ—Ç–∞—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —á—Ç–æ —É–≥–æ–¥–Ω–æ –Ω–∞–¥–æ–ª–≥–æ.
            ')->photo(Storage::path('hiro9.webp'))->send();

            sleep(2);

                $this->chat->message('*5. –õ–∏–Ω–∏—è –±—Ä–∞–∫–∞*
–õ–∏–Ω–∏—è –±—Ä–∞–∫–∞ - —ç—Ç–æ –∫–æ—Ä–æ—Ç–∫–∞—è –ª–∏–Ω–∏—è –Ω–∞–¥ –ª–∏–Ω–∏–µ–π –ª—é–±–≤–∏, –Ω–∞—á–∏–Ω–∞—é—â–∞—è—Å—è —Å—Ä–∞–∑—É –ø–æ–¥ –º–∏–∑–∏–Ω—Ü–µ–º. –û–Ω–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è –∏ –±—Ä–∞–∫.
–£ –∫–æ–≥–æ-—Ç–æ –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ª–∏–Ω–∏—è, —É –∫–æ–≥–æ-—Ç–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫.–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–Ω–∞—á–∏—Ç. –ü—Ä–æ—Å—Ç–æ –ø—Ä–æ—á—Ç–∏—Ç–µ —Å–∞–º—É—é —á–µ—Ç–∫—É—é.
–ï—Å–ª–∏ –µ—Å—Ç—å –¥–≤–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ —á–µ—Ç–∫–∏–µ –ª–∏–Ω–∏–∏ –±—Ä–∞–∫–∞, –µ–º—É –Ω—É–∂–Ω–æ –æ—Å—Ç–µ—Ä–µ–≥–∞—Ç—å—Å—è –ª—é–±–æ–≤–Ω–æ–≥–æ —Ç—Ä–µ—É–≥–æ–ª—å–Ω–∏–∫–∞.
–ï—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª–∏–Ω–∏–π –±—Ä–∞–∫–∞ –±–µ–∑ –æ—Å–Ω–æ–≤–Ω–æ–π, –µ–≥–æ —Å–µ–º–µ–π–Ω–∞—è –∂–∏–∑–Ω—å –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω–æ–π.
            ')->photo(Storage::path('hiro10.webp'))->send();

                $this->chat->message('–ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –∏–¥–µ—Ç –≤–≤–µ—Ä—Ö –∏–ª–∏ –∫–æ—Ä–æ—Ç–∫–∞—è –∏ –Ω–µ–≥–ª—É–±–æ–∫–∞—è, –æ–±—ã—á–Ω–æ –æ–Ω / –æ–Ω–∞ –Ω–µ –±—É–¥–µ—Ç –∂–µ–Ω–∏—Ç—å—Å—è –∏–ª–∏ –∂–µ–Ω–∏—Ç—Å—è –æ—á–µ–Ω—å –ø–æ–∑–¥–Ω–æ.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è –±—Ä–∞–∫–∞ —Ç—è–Ω–µ—Ç—Å—è –¥–æ –º–∏–∑–∏–Ω—Ü–∞ –∏–ª–∏ –±–µ–∑—ã–º—è–Ω–Ω–æ–≥–æ –ø–∞–ª—å—Ü–∞, —É —ç—Ç–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤—ã—Å–æ–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Å—É–ø—Ä—É–≥–∞.
–ï—Å–ª–∏ –ª–∏–Ω–∏—è –±—Ä–∞–∫–∞ —Ç—è–Ω–µ—Ç—Å—è –¥–æ –±–µ–∑—ã–º—è–Ω–Ω–æ–≥–æ –ø–∞–ª—å—Ü–∞, —ç—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ —Å–µ–º—å—è –µ–≥–æ / –µ–µ —Å—É–ø—Ä—É–≥–∞ –±–æ–≥–∞—Ç–∞ –∏ –¥—Ä—É–∂–Ω–∞.
–û–¥–Ω–∞–∫–æ –µ—Å–ª–∏ –ª–∏–Ω–∏—è –±—Ä–∞–∫–∞ —Ç—è–Ω—É—Ç—å—Å—è –¥–∞–ª—å—à–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –ø–∞–ª—å—Ü–∞ - –Ω–µ—Ö–æ—Ä–æ—à–æ: –±—Ä–∞–∫ –º–æ–∂–µ—Ç —Å–∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏ –∏ –±–æ–≥–∞—Ç—Å—Ç–≤–µ.
            ')->photo(Storage::path('hiro11.webp'))->send();

        }

        if ($text == 'üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø' || $text == 'üíü –õ—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø') {

            if ($text == 'üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø'){
                $textMessage = '*üîÆ –í—ã–±–µ—Ä–∏—Ç–µ –í–∞—à –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ —Å–µ–≥–æ–¥–Ω—è*';
                $messageIMG = 'horoscope.jpg';
            }
            if ($text == 'üíü –õ—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø'){
                $textMessage = '*üíü –í—ã–±–µ—Ä–∏—Ç–µ –í–∞—à –∑–Ω–∞–∫ –∑–æ–¥–∏–∞–∫–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å üíû –ª—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ —Å–µ–≥–æ–¥–Ω—è*';
                $messageIMG = 'love_horocope2.jpg';
            }


            $this->chat->message("$textMessage")->photo(Storage::path("$messageIMG"))
                ->replyKeyboard(
                    ReplyKeyboard::make()
                        ->row([
                            ReplyButton::make('‚ôàÔ∏è –û–≤–µ–Ω'),
                            ReplyButton::make('‚ôâÔ∏è –¢–µ–ª–µ—Ü'),
                            ReplyButton::make('‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã'),
                        ])
                        ->row([
                            ReplyButton::make('‚ôãÔ∏è –†–∞–∫'),
                            ReplyButton::make('‚ôåÔ∏è –õ–µ–≤'),
                            ReplyButton::make('‚ôçÔ∏è –î–µ–≤–∞'),
                        ])
                        ->row([
                            ReplyButton::make('‚ôéÔ∏è –í–µ—Å—ã'),
                            ReplyButton::make('‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω'),
                            ReplyButton::make('‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü'),
                        ])
                        ->row([
                            ReplyButton::make('‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥'),
                            ReplyButton::make('‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π'),
                            ReplyButton::make('‚ôìÔ∏è –†—ã–±—ã'),
                        ])
                        ->row([
                            ReplyButton::make('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'),
                        ])
                )
                ->send();

            if ($text == 'üîÆ –ì–æ—Ä–æ—Å–∫–æ–ø') {
                $horoscope_type = 'general';
            }
            if ($text == 'üíü –õ—é–±–æ–≤–Ω—ã–π –≥–æ—Ä–æ—Å–∫–æ–ø') {
                $horoscope_type = 'love';
            }
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∏–ø –≥–æ—Ä–æ—Å–∫–æ–ø–∞ –≤ –ë–î
            DB::table('telegraph_chats')
                ->where('chat_id', $this->chat->chat_id)
                ->update([
                    'horoscope_type' => $horoscope_type
                ]);
        }

        if($text == '‚ôàÔ∏è –û–≤–µ–Ω' || $text == '‚ôâÔ∏è –¢–µ–ª–µ—Ü' || $text == '‚ôäÔ∏è –ë–ª–∏–∑–Ω–µ—Ü—ã' || $text == '‚ôãÔ∏è –†–∞–∫'
            || $text == '‚ôåÔ∏è –õ–µ–≤' || $text == '‚ôçÔ∏è –î–µ–≤–∞' || $text == '‚ôéÔ∏è –í–µ—Å—ã' || $text == '‚ôèÔ∏è –°–∫–æ—Ä–ø–∏–æ–Ω'
            || $text == '‚ôêÔ∏è –°—Ç—Ä–µ–ª–µ—Ü' || $text == '‚ôëÔ∏è –ö–æ–∑–µ—Ä–æ–≥' || $text == '‚ôíÔ∏è –í–æ–¥–æ–ª–µ–π' || $text == '‚ôìÔ∏è –†—ã–±—ã'){

            // –ü–æ–ª—É—á–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏—è –∑–æ–¥–∏–∞–∫–∞ –Ω–∞ –∞–Ω–≥–ª.
            $zodiac = Helper::zodiacName($text);

            $userChat = DB::table('telegraph_chats')
                ->select('last_zodiac', 'horoscope_type')->where('chat_id', $this->chat->chat_id)
                ->first();

            $homepage = file_get_contents("https://orakul.com/horoscope/astrologic/{$userChat->horoscope_type}/{$zodiac}/today.html");

            $pattern = '/<div class="horoBlock">(.*?)>(.*?)<\/div>/s';
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            if (preg_match($pattern, $homepage, $matches)) {
                // $matches[1] —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–µ–∂–¥—É —Ç–µ–≥–æ–º
                $foundText = $matches[2];
                // –í—ã–≤–æ–¥–∏–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                $horo = trim(stristr($foundText, '<', true));
            } else {
                // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                $horo = "–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }

            $dt = Carbon::now();
            $todayDate = str_replace('-', '.', $dt->format('d.m.Y'));

            $this->chat->message("*$text* –Ω–∞ $todayDate

üîÆ $horo")->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('–ù–∞ –∑–∞–≤—Ç—Ä–∞'),
                        ReplyButton::make('–ù–∞ –Ω–µ–¥–µ–ª—é'),
                    ])
                    ->row([
                        ReplyButton::make('–ù–∞ –º–µ—Å—è—Ü'),
                        ReplyButton::make('–ù–∞ –≥–æ–¥'),
                    ])
                    ->row([
                        ReplyButton::make('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'),
                    ])
            )
                ->send();

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ –ë–î
            DB::table('telegraph_chats')
                ->where('chat_id', $this->chat->chat_id)
                ->update([
                    'last_zodiac' => $zodiac,
                    // 'horoscope_type' => $horoscope_type,
                ]);
        }


        // –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –∑–∞–≤—Ç—Ä–∞
        if ($text == '–ù–∞ –∑–∞–≤—Ç—Ä–∞') {

            $userChat = DB::table('telegraph_chats')
                ->select('last_zodiac', 'horoscope_type')->where('chat_id', $this->chat->chat_id)
                ->first();

            $homepage = file_get_contents("https://orakul.com/horoscope/astrologic/{$userChat->horoscope_type}/{$userChat->last_zodiac}/tomorrow.html");

            $pattern = '/<div class="horoBlock">(.*?)>(.*?)<\/div>/s';
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            if (preg_match($pattern, $homepage, $matches)) {
                // $matches[1] —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–µ–∂–¥—É —Ç–µ–≥–æ–º
                $foundText = $matches[2];
                // –í—ã–≤–æ–¥–∏–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                $horo = trim(stristr($foundText, '<', true));
            } else {
                // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                $horo = "–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }

            $this->chat->message("üîÆ $horo")->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('–ù–∞ –∑–∞–≤—Ç—Ä–∞'),
                        ReplyButton::make('–ù–∞ –Ω–µ–¥–µ–ª—é'),
                    ])
                    ->row([
                        ReplyButton::make('–ù–∞ –º–µ—Å—è—Ü'),
                        ReplyButton::make('–ù–∞ –≥–æ–¥'),
                    ])
                    ->row([
                        ReplyButton::make('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'),
                    ])
            )
                ->send();

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ –ë–î
            DB::table('telegraph_chats')
                ->where('chat_id', $this->chat->chat_id)
                ->update(['last_zodiac' => $userChat->last_zodiac]);
        }

        // –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –Ω–µ–¥–µ–ª—é
        if ($text == '–ù–∞ –Ω–µ–¥–µ–ª—é') {

            $userChat = DB::table('telegraph_chats')
                ->select('last_zodiac', 'horoscope_type')->where('chat_id', $this->chat->chat_id)
                ->first();

            $homepage = file_get_contents("https://orakul.com/horoscope/astrologic/{$userChat->horoscope_type}/{$userChat->last_zodiac}/week.html");

            $pattern = '/<div class="horoBlock">(.*?)>(.*?)<\/div>/s';
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            if (preg_match($pattern, $homepage, $matches)) {
                // $matches[1] —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–µ–∂–¥—É —Ç–µ–≥–æ–º
                $foundText = $matches[2];
                // –í—ã–≤–æ–¥–∏–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                $horo = trim(stristr($foundText, '<', true));
            } else {
                // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                $horo = "–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }

            $this->chat->message("üîÆ $horo")->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('–ù–∞ –∑–∞–≤—Ç—Ä–∞'),
                        ReplyButton::make('–ù–∞ –Ω–µ–¥–µ–ª—é'),
                    ])
                    ->row([
                        ReplyButton::make('–ù–∞ –º–µ—Å—è—Ü'),
                        ReplyButton::make('–ù–∞ –≥–æ–¥'),
                    ])
                    ->row([
                        ReplyButton::make('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'),
                    ])
            )
                ->send();

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ –ë–î
            DB::table('telegraph_chats')
                ->where('chat_id', $this->chat->chat_id)
                ->update(['last_zodiac' => $userChat->last_zodiac]);
        }

        // –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –º–µ—Å—è—Ü
        if ($text == '–ù–∞ –º–µ—Å—è—Ü') {

            $userChat = DB::table('telegraph_chats')
                ->select('last_zodiac', 'horoscope_type')->where('chat_id', $this->chat->chat_id)
                ->first();

            $homepage = file_get_contents("https://orakul.com/horoscope/astrologic/{$userChat->horoscope_type}/{$userChat->last_zodiac}/month.html");

            $pattern = '/<div class="horoBlock">(.*?)>(.*?)<\/div>/s';
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            if (preg_match($pattern, $homepage, $matches)) {
                // $matches[1] —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–µ–∂–¥—É —Ç–µ–≥–æ–º
                $foundText = $matches[2];
                // –í—ã–≤–æ–¥–∏–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                $horo = trim(stristr($foundText, '<', true));
            } else {
                // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                $horo = "–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }

            $this->chat->message("üîÆ $horo")->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('–ù–∞ –∑–∞–≤—Ç—Ä–∞'),
                        ReplyButton::make('–ù–∞ –Ω–µ–¥–µ–ª—é'),
                    ])
                    ->row([
                        ReplyButton::make('–ù–∞ –º–µ—Å—è—Ü'),
                        ReplyButton::make('–ù–∞ –≥–æ–¥'),
                    ])
                    ->row([
                        ReplyButton::make('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'),
                    ])
            )
                ->send();

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ –ë–î
            DB::table('telegraph_chats')
                ->where('chat_id', $this->chat->chat_id)
                ->update(['last_zodiac' => $userChat->last_zodiac]);
        }

        // –ì–æ—Ä–æ—Å–∫–æ–ø –Ω–∞ –≥–æ–¥
        if ($text == '–ù–∞ –≥–æ–¥') {

            $userChat = DB::table('telegraph_chats')
                ->select('last_zodiac', 'horoscope_type')->where('chat_id', $this->chat->chat_id)
                ->first();

            $homepage = file_get_contents("https://orakul.com/horoscope/astrologic/{$userChat->horoscope_type}/{$userChat->last_zodiac}/year.html");

            $pattern = '/<div class="horoBlock">(.*?)>(.*?)<\/div>/s';
            // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ–∏—Å–∫ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
            if (preg_match($pattern, $homepage, $matches)) {
                // $matches[1] —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç, –Ω–∞–π–¥–µ–Ω–Ω—ã–π –º–µ–∂–¥—É —Ç–µ–≥–æ–º
                $foundText = $matches[2];
                // –í—ã–≤–æ–¥–∏–º –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç
                $horo = trim(stristr($foundText, '<', true));
            } else {
                // –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                $horo = "–ì–æ—Ä–æ—Å–∫–æ–ø –Ω–µ –Ω–∞–π–¥–µ–Ω";
            }

            $this->chat->message("üîÆ $horo")->replyKeyboard(
                ReplyKeyboard::make()
                    ->row([
                        ReplyButton::make('–ù–∞ –∑–∞–≤—Ç—Ä–∞'),
                        ReplyButton::make('–ù–∞ –Ω–µ–¥–µ–ª—é'),
                    ])
                    ->row([
                        ReplyButton::make('–ù–∞ –º–µ—Å—è—Ü'),
                        ReplyButton::make('–ù–∞ –≥–æ–¥'),
                    ])
                    ->row([
                        ReplyButton::make('üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'),
                    ])
            )
                ->send();

            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π –≥–æ—Ä–æ—Å–∫–æ–ø –≤ –ë–î
            DB::table('telegraph_chats')
                ->where('chat_id', $this->chat->chat_id)
                ->update(['last_zodiac' => $userChat->last_zodiac]);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞—Ç—É –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∫ –±–æ—Ç—É
        DB::table('telegraph_chats')
        ->where('chat_id', $this->chat->chat_id)
        ->update(['updated_at' => Carbon::now()]);
    }
}
